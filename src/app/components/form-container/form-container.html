<form class="form-container">
  @let form = stipendioForm();
  @let model = formModel()();

  <!-- Sezione Dati Principali -->
  <fieldset>
    <legend>Dati Principali</legend>

    <div class="form-group">
      <label for="ral">RAL (Reddito Annuo Lordo) *</label>
      <input
        id="ral"
        type="number"
        [formField]="form.ral"
        placeholder="Es. 35000"
        aria-required="true"
        [attr.aria-invalid]="form.ral().invalid()"
        [attr.aria-describedby]="form.ral().invalid() ? 'ral-error' : null"
      />
      @if (form.ral().invalid()) {
        @for (error of form.ral().errors(); track error.kind) {
          <span id="ral-error" class="error-message" role="alert">{{ error.message }}</span>
        }
      }
    </div>

    <div class="form-group">
      <label for="mensilita">Mensilità *</label>
      <select
        id="mensilita"
        [formField]="form.mensilita"
        aria-required="true"
        [attr.aria-invalid]="form.mensilita().invalid()"
        [attr.aria-describedby]="form.mensilita().invalid() ? 'mensilita-error' : null"
      >
        @for (m of mensilita; track m) {
          <option [value]="m">{{ m }}</option>
        }
      </select>
      @if (form.mensilita().invalid()) {
        @for (error of form.mensilita().errors(); track error.kind) {
          <span id="mensilita-error" class="error-message" role="alert">{{ error.message }}</span>
        }
      }
    </div>

    <div class="form-group">
      <label for="tipoContratto">Tipo Contratto *</label>
      <select id="tipoContratto" [formField]="form.tipoContratto" aria-required="true">
        @for (tipo of tipiContratto; track tipo.value) {
          <option [value]="tipo.value">{{ tipo.label }}</option>
        }
      </select>
    </div>

    <div class="form-group">
      <label for="annoFiscale">Anno Fiscale *</label>
      <select id="annoFiscale" [formField]="form.annoFiscale" aria-required="true">
        @for (anno of anniFiscali; track anno) {
          <option [value]="anno">{{ anno }}</option>
        }
      </select>
    </div>

    <div class="form-group">
      <label for="regione">Regione *</label>
      <select
        id="regione"
        [formField]="form.regione"
        aria-required="true"
        [attr.aria-invalid]="form.regione().invalid()"
        [attr.aria-describedby]="form.regione().invalid() ? 'regione-error' : null"
      >
        @for (regione of regioniDisponibili; track regione.value) {
          <option [value]="regione.value">{{ regione.label }}</option>
        }
      </select>
      @if (form.regione().invalid()) {
        @for (error of form.regione().errors(); track error.kind) {
          <span id="regione-error" class="error-message" role="alert">{{ error.message }}</span>
        }
      }
    </div>

    <div class="form-group">
      <label for="comune">Comune *</label>
      <select
        id="comune"
        [formField]="form.comune"
        aria-required="true"
        [attr.aria-invalid]="form.comune().invalid()"
        [attr.aria-describedby]="form.comune().invalid() ? 'comune-error' : null"
      >
        @for (comune of comuniDisponibili; track comune.value) {
          <option [value]="comune.value">{{ comune.label }}</option>
        }
      </select>
      @if (form.comune().invalid()) {
        @for (error of form.comune().errors(); track error.kind) {
          <span id="comune-error" class="error-message" role="alert">{{ error.message }}</span>
        }
      }
    </div>
  </fieldset>

  <!-- Sezione Opzioni Contrattuali -->
  <fieldset>
    <legend>Opzioni Contrattuali</legend>

    <div class="form-group">
      <label for="giorniLavorati">Giorni Lavorati (opzionale)</label>
      <input
        id="giorniLavorati"
        type="number"
        [formField]="form.giorniLavorati"
        placeholder="Default: 365"
        [attr.aria-invalid]="form.giorniLavorati().invalid()"
        [attr.aria-describedby]="form.giorniLavorati().invalid() ? 'giorniLavorati-error' : null"
      />
      @if (form.giorniLavorati().invalid()) {
        @for (error of form.giorniLavorati().errors(); track error.kind) {
          <span id="giorniLavorati-error" class="error-message" role="alert">{{
            error.message
          }}</span>
        }
      }
    </div>

    <div class="form-group checkbox">
      <input id="aziendaConCigs" type="checkbox" [formField]="form.aziendaConCigs" />
      <label for="aziendaConCigs">Azienda con più di 15 dipendenti (CIGS)</label>
    </div>

    <div class="form-group checkbox">
      <input id="iscrittoPost1996" type="checkbox" [formField]="form.iscrittoPost1996" />
      <label for="iscrittoPost1996">Iscritto alla previdenza dal 1996 in poi</label>
    </div>

    <div class="form-group checkbox">
      <input
        id="neoassuntoFuoriSede2025"
        type="checkbox"
        [formField]="form.neoassuntoFuoriSede2025"
      />
      <label for="neoassuntoFuoriSede2025">Neoassunto 2025 fuori sede (>100km)</label>
    </div>
  </fieldset>

  <!-- Sezione Altri Redditi e Detrazioni -->
  <fieldset>
    <legend>Altri Redditi e Detrazioni</legend>

    <div class="form-group">
      <label for="altriRedditi">Altri Redditi (€/anno)</label>
      <input
        id="altriRedditi"
        type="number"
        [formField]="form.altriRedditi"
        placeholder="Es. redditi fondiari"
        [attr.aria-invalid]="form.altriRedditi().invalid()"
        [attr.aria-describedby]="form.altriRedditi().invalid() ? 'altriRedditi-error' : null"
      />
      @if (form.altriRedditi().invalid()) {
        @for (error of form.altriRedditi().errors(); track error.kind) {
          <span id="altriRedditi-error" class="error-message" role="alert">{{
            error.message
          }}</span>
        }
      }
    </div>

    <div class="form-group">
      <label for="altreDetrazioni">Altre Detrazioni (€/anno)</label>
      <input
        id="altreDetrazioni"
        type="number"
        [formField]="form.altreDetrazioni"
        placeholder="Es. interessi mutuo"
        [attr.aria-invalid]="form.altreDetrazioni().invalid()"
        [attr.aria-describedby]="form.altreDetrazioni().invalid() ? 'altreDetrazioni-error' : null"
      />
      @if (form.altreDetrazioni().invalid()) {
        @for (error of form.altreDetrazioni().errors(); track error.kind) {
          <span id="altreDetrazioni-error" class="error-message" role="alert">{{
            error.message
          }}</span>
        }
      }
    </div>
  </fieldset>

  <!-- Sezione Coniuge a Carico -->
  <fieldset>
    <legend>Coniuge a Carico</legend>

    <div class="form-group checkbox">
      <input id="coniugeEnabled" type="checkbox" [formField]="form.coniuge.enabled" />
      <label for="coniugeEnabled">Ho un coniuge a carico</label>
    </div>

    @if (model.coniuge.enabled) {
      <div class="form-group">
        <label for="coniugeReddito">Reddito annuo coniuge (€)</label>
        <input
          id="coniugeReddito"
          type="number"
          [formField]="form.coniuge.redditoAnnuo"
          placeholder="Max €2.840,51 per detrazione"
          [attr.aria-invalid]="form.coniuge.redditoAnnuo().invalid()"
          [attr.aria-describedby]="
            form.coniuge.redditoAnnuo().invalid() ? 'coniugeReddito-error' : null
          "
        />
        @if (form.coniuge.redditoAnnuo().invalid()) {
          @for (error of form.coniuge.redditoAnnuo().errors(); track error.kind) {
            <span id="coniugeReddito-error" class="error-message" role="alert">{{
              error.message
            }}</span>
          }
        }
      </div>

      <div class="form-group">
        <label for="coniugePercentuale">Percentuale a carico (%)</label>
        <input
          id="coniugePercentuale"
          type="number"
          [formField]="form.coniuge.percentualeCarico"
          [attr.aria-invalid]="form.coniuge.percentualeCarico().invalid()"
          [attr.aria-describedby]="
            form.coniuge.percentualeCarico().invalid() ? 'coniugePercentuale-error' : null
          "
        />
        @if (form.coniuge.percentualeCarico().invalid()) {
          @for (error of form.coniuge.percentualeCarico().errors(); track error.kind) {
            <span id="coniugePercentuale-error" class="error-message" role="alert">{{
              error.message
            }}</span>
          }
        }
      </div>
    }
  </fieldset>

  <!-- Sezione Figli a Carico -->
  <fieldset>
    <legend>Figli a Carico</legend>

    <div class="form-group checkbox">
      <input id="haFigliACarico" type="checkbox" [formField]="form.haFigliACarico" />
      <label for="haFigliACarico">Ho figli a carico (per soglia fringe benefit)</label>
    </div>

    @for (figlio of model.figli; track $index) {
      <div class="nested-item">
        <h4>Figlio {{ $index + 1 }}</h4>

        <div class="form-group">
          <label [for]="'figlioEta' + $index">Età</label>
          <input
            [id]="'figlioEta' + $index"
            type="number"
            [formField]="form.figli[$index].eta"
            [attr.aria-invalid]="form.figli[$index].eta().invalid()"
            [attr.aria-describedby]="
              form.figli[$index].eta().invalid() ? 'figlioEta' + $index + '-error' : null
            "
          />
          @if (form.figli[$index].eta().invalid()) {
            @for (error of form.figli[$index].eta().errors(); track error.kind) {
              <span [id]="'figlioEta' + $index + '-error'" class="error-message" role="alert">{{
                error.message
              }}</span>
            }
          }
        </div>

        <div class="form-group checkbox">
          <input
            [id]="'figlioDisabile' + $index"
            type="checkbox"
            [formField]="form.figli[$index].disabile"
          />
          <label [for]="'figlioDisabile' + $index">Disabile</label>
        </div>

        <div class="form-group">
          <label [for]="'figlioPercentuale' + $index">Percentuale a carico (%)</label>
          <input
            [id]="'figlioPercentuale' + $index"
            type="number"
            [formField]="form.figli[$index].percentualeCarico"
            [attr.aria-invalid]="form.figli[$index].percentualeCarico().invalid()"
            [attr.aria-describedby]="
              form.figli[$index].percentualeCarico().invalid()
                ? 'figlioPercentuale' + $index + '-error'
                : null
            "
          />
          @if (form.figli[$index].percentualeCarico().invalid()) {
            @for (error of form.figli[$index].percentualeCarico().errors(); track error.kind) {
              <span
                [id]="'figlioPercentuale' + $index + '-error'"
                class="error-message"
                role="alert"
                >{{ error.message }}</span
              >
            }
          }
        </div>

        <button type="button" (click)="removeFiglio($index)">Rimuovi figlio</button>
      </div>
    }

    <button type="button" (click)="addFiglio()">Aggiungi figlio</button>
  </fieldset>

  <!-- Sezione Ascendenti a Carico -->
  <fieldset>
    <legend>Ascendenti a Carico (genitori/nonni)</legend>

    @for (ascendente of model.ascendenti; track $index) {
      <div class="nested-item">
        <h4>Ascendente {{ $index + 1 }}</h4>

        <div class="form-group">
          <label [for]="'ascendenteReddito' + $index">Reddito annuo (€)</label>
          <input
            [id]="'ascendenteReddito' + $index"
            type="number"
            [formField]="form.ascendenti[$index].redditoAnnuo"
            [attr.aria-invalid]="form.ascendenti[$index].redditoAnnuo().invalid()"
            [attr.aria-describedby]="
              form.ascendenti[$index].redditoAnnuo().invalid()
                ? 'ascendenteReddito' + $index + '-error'
                : null
            "
          />
          @if (form.ascendenti[$index].redditoAnnuo().invalid()) {
            @for (error of form.ascendenti[$index].redditoAnnuo().errors(); track error.kind) {
              <span
                [id]="'ascendenteReddito' + $index + '-error'"
                class="error-message"
                role="alert"
                >{{ error.message }}</span
              >
            }
          }
        </div>

        <div class="form-group checkbox">
          <input
            [id]="'ascendenteConvivente' + $index"
            type="checkbox"
            [formField]="form.ascendenti[$index].convivente"
          />
          <label [for]="'ascendenteConvivente' + $index">Convivente</label>
        </div>

        <button type="button" (click)="removeAscendente($index)">Rimuovi ascendente</button>
      </div>
    }

    <button type="button" (click)="addAscendente()">Aggiungi ascendente</button>
  </fieldset>

  <!-- Sezione Fringe Benefit -->
  <fieldset>
    <legend>Fringe Benefit</legend>

    <div class="form-group checkbox">
      <input id="fringeBenefitEnabled" type="checkbox" [formField]="form.fringeBenefit.enabled" />
      <label for="fringeBenefitEnabled">Ho fringe benefit</label>
    </div>

    @if (model.fringeBenefit.enabled) {
      <div class="form-group">
        <label for="buoniAcquisto">Buoni acquisto/spesa (€/anno)</label>
        <input
          id="buoniAcquisto"
          type="number"
          [formField]="form.fringeBenefit.buoniAcquisto"
          [attr.aria-invalid]="form.fringeBenefit.buoniAcquisto().invalid()"
          [attr.aria-describedby]="
            form.fringeBenefit.buoniAcquisto().invalid() ? 'buoniAcquisto-error' : null
          "
        />
        @if (form.fringeBenefit.buoniAcquisto().invalid()) {
          @for (error of form.fringeBenefit.buoniAcquisto().errors(); track error.kind) {
            <span id="buoniAcquisto-error" class="error-message" role="alert">{{
              error.message
            }}</span>
          }
        }
      </div>

      <div class="form-group">
        <label for="buoniCarburante">Buoni carburante (€/anno)</label>
        <input
          id="buoniCarburante"
          type="number"
          [formField]="form.fringeBenefit.buoniCarburante"
          [attr.aria-invalid]="form.fringeBenefit.buoniCarburante().invalid()"
          [attr.aria-describedby]="
            form.fringeBenefit.buoniCarburante().invalid() ? 'buoniCarburante-error' : null
          "
        />
        @if (form.fringeBenefit.buoniCarburante().invalid()) {
          @for (error of form.fringeBenefit.buoniCarburante().errors(); track error.kind) {
            <span id="buoniCarburante-error" class="error-message" role="alert">{{
              error.message
            }}</span>
          }
        }
      </div>

      <div class="form-group">
        <label for="rimborsoUtenze">Rimborso utenze domestiche (€/anno)</label>
        <input
          id="rimborsoUtenze"
          type="number"
          [formField]="form.fringeBenefit.rimborsoUtenze"
          [attr.aria-invalid]="form.fringeBenefit.rimborsoUtenze().invalid()"
          [attr.aria-describedby]="
            form.fringeBenefit.rimborsoUtenze().invalid() ? 'rimborsoUtenze-error' : null
          "
        />
        @if (form.fringeBenefit.rimborsoUtenze().invalid()) {
          @for (error of form.fringeBenefit.rimborsoUtenze().errors(); track error.kind) {
            <span id="rimborsoUtenze-error" class="error-message" role="alert">{{
              error.message
            }}</span>
          }
        }
      </div>

      <div class="form-group">
        <label for="rimborsoAffitto">Rimborso affitto prima casa (€/anno)</label>
        <input
          id="rimborsoAffitto"
          type="number"
          [formField]="form.fringeBenefit.rimborsoAffitto"
          [attr.aria-invalid]="form.fringeBenefit.rimborsoAffitto().invalid()"
          [attr.aria-describedby]="
            form.fringeBenefit.rimborsoAffitto().invalid() ? 'rimborsoAffitto-error' : null
          "
        />
        @if (form.fringeBenefit.rimborsoAffitto().invalid()) {
          @for (error of form.fringeBenefit.rimborsoAffitto().errors(); track error.kind) {
            <span id="rimborsoAffitto-error" class="error-message" role="alert">{{
              error.message
            }}</span>
          }
        }
      </div>

      <div class="form-group">
        <label for="rimborsoInteressiMutuo">Rimborso interessi mutuo (€/anno)</label>
        <input
          id="rimborsoInteressiMutuo"
          type="number"
          [formField]="form.fringeBenefit.rimborsoInteressiMutuo"
          [attr.aria-invalid]="form.fringeBenefit.rimborsoInteressiMutuo().invalid()"
          [attr.aria-describedby]="
            form.fringeBenefit.rimborsoInteressiMutuo().invalid()
              ? 'rimborsoInteressiMutuo-error'
              : null
          "
        />
        @if (form.fringeBenefit.rimborsoInteressiMutuo().invalid()) {
          @for (error of form.fringeBenefit.rimborsoInteressiMutuo().errors(); track error.kind) {
            <span id="rimborsoInteressiMutuo-error" class="error-message" role="alert">{{
              error.message
            }}</span>
          }
        }
      </div>

      <div class="form-group">
        <label for="fringeBenefitAltri">Altri fringe benefit (€/anno)</label>
        <input
          id="fringeBenefitAltri"
          type="number"
          [formField]="form.fringeBenefit.altri"
          [attr.aria-invalid]="form.fringeBenefit.altri().invalid()"
          [attr.aria-describedby]="
            form.fringeBenefit.altri().invalid() ? 'fringeBenefitAltri-error' : null
          "
        />
        @if (form.fringeBenefit.altri().invalid()) {
          @for (error of form.fringeBenefit.altri().errors(); track error.kind) {
            <span id="fringeBenefitAltri-error" class="error-message" role="alert">{{
              error.message
            }}</span>
          }
        }
      </div>

      <!-- Auto Aziendale -->
      <div class="form-group checkbox">
        <input
          id="autoAziendaleEnabled"
          type="checkbox"
          [formField]="form.fringeBenefit.autoAziendaleEnabled"
        />
        <label for="autoAziendaleEnabled">Ho auto aziendale</label>
      </div>

      @if (model.fringeBenefit.autoAziendaleEnabled) {
        <div class="nested-item">
          <h4>Auto Aziendale</h4>

          <div class="form-group">
            <label for="costoKmAci">Costo km ACI (€/km)</label>
            <input
              id="costoKmAci"
              type="number"
              [formField]="form.fringeBenefit.autoAziendale.costoKmAci"
              [attr.aria-invalid]="form.fringeBenefit.autoAziendale.costoKmAci().invalid()"
              [attr.aria-describedby]="
                form.fringeBenefit.autoAziendale.costoKmAci().invalid() ? 'costoKmAci-error' : null
              "
            />
            @if (form.fringeBenefit.autoAziendale.costoKmAci().invalid()) {
              @for (
                error of form.fringeBenefit.autoAziendale.costoKmAci().errors();
                track error.kind
              ) {
                <span id="costoKmAci-error" class="error-message" role="alert">{{
                  error.message
                }}</span>
              }
            }
          </div>

          <div class="form-group">
            <label for="tipoAlimentazione">Tipo alimentazione</label>
            <select
              id="tipoAlimentazione"
              [formField]="form.fringeBenefit.autoAziendale.tipoAlimentazione"
            >
              @for (tipo of tipiAlimentazione; track tipo.value) {
                <option [value]="tipo.value">{{ tipo.label }}</option>
              }
            </select>
          </div>

          <div class="form-group">
            <label for="mesiUtilizzo">Mesi di utilizzo</label>
            <input
              id="mesiUtilizzo"
              type="number"
              [formField]="form.fringeBenefit.autoAziendale.mesiUtilizzo"
              [attr.aria-invalid]="form.fringeBenefit.autoAziendale.mesiUtilizzo().invalid()"
              [attr.aria-describedby]="
                form.fringeBenefit.autoAziendale.mesiUtilizzo().invalid()
                  ? 'mesiUtilizzo-error'
                  : null
              "
            />
            @if (form.fringeBenefit.autoAziendale.mesiUtilizzo().invalid()) {
              @for (
                error of form.fringeBenefit.autoAziendale.mesiUtilizzo().errors();
                track error.kind
              ) {
                <span id="mesiUtilizzo-error" class="error-message" role="alert">{{
                  error.message
                }}</span>
              }
            }
          </div>

          <div class="form-group">
            <label for="trattenutaDipendente">Trattenuta dipendente (€/anno)</label>
            <input
              id="trattenutaDipendente"
              type="number"
              [formField]="form.fringeBenefit.autoAziendale.trattenutaDipendente"
              [attr.aria-invalid]="
                form.fringeBenefit.autoAziendale.trattenutaDipendente().invalid()
              "
              [attr.aria-describedby]="
                form.fringeBenefit.autoAziendale.trattenutaDipendente().invalid()
                  ? 'trattenutaDipendente-error'
                  : null
              "
            />
            @if (form.fringeBenefit.autoAziendale.trattenutaDipendente().invalid()) {
              @for (
                error of form.fringeBenefit.autoAziendale.trattenutaDipendente().errors();
                track error.kind
              ) {
                <span id="trattenutaDipendente-error" class="error-message" role="alert">{{
                  error.message
                }}</span>
              }
            }
          </div>

          <div class="form-group checkbox">
            <input
              id="assegnatoPre2025"
              type="checkbox"
              [formField]="form.fringeBenefit.autoAziendale.assegnatoPre2025"
            />
            <label for="assegnatoPre2025">Assegnato prima del 2025 (regime CO2)</label>
          </div>

          @if (model.fringeBenefit.autoAziendale.assegnatoPre2025) {
            <div class="form-group">
              <label for="emissioniCO2">Emissioni CO2 (g/km)</label>
              <input
                id="emissioniCO2"
                type="number"
                [formField]="form.fringeBenefit.autoAziendale.emissioniCO2"
                [attr.aria-invalid]="form.fringeBenefit.autoAziendale.emissioniCO2().invalid()"
                [attr.aria-describedby]="
                  form.fringeBenefit.autoAziendale.emissioniCO2().invalid()
                    ? 'emissioniCO2-error'
                    : null
                "
              />
              @if (form.fringeBenefit.autoAziendale.emissioniCO2().invalid()) {
                @for (
                  error of form.fringeBenefit.autoAziendale.emissioniCO2().errors();
                  track error.kind
                ) {
                  <span id="emissioniCO2-error" class="error-message" role="alert">{{
                    error.message
                  }}</span>
                }
              }
            </div>
          }
        </div>
      }
    }
  </fieldset>

  <!-- Sezione Rimborsi Trasferta -->
  <fieldset>
    <legend>Rimborsi Trasferta</legend>

    <div class="form-group checkbox">
      <input
        id="rimborsiTrasfertaEnabled"
        type="checkbox"
        [formField]="form.rimborsiTrasferta.enabled"
      />
      <label for="rimborsiTrasfertaEnabled">Ho rimborsi trasferta</label>
    </div>

    @if (model.rimborsiTrasferta.enabled) {
      <div class="form-group">
        <label for="modalitaRimborso">Modalità rimborso</label>
        <select id="modalitaRimborso" [formField]="form.rimborsiTrasferta.modalitaRimborso">
          @for (modalita of modalitaRimborso; track modalita.value) {
            <option [value]="modalita.value">{{ modalita.label }}</option>
          }
        </select>
      </div>

      <div class="form-group">
        <label for="giorniTrasfertaItalia">Giorni trasferta Italia</label>
        <input
          id="giorniTrasfertaItalia"
          type="number"
          [formField]="form.rimborsiTrasferta.giorniTrasfertaItalia"
          [attr.aria-invalid]="form.rimborsiTrasferta.giorniTrasfertaItalia().invalid()"
          [attr.aria-describedby]="
            form.rimborsiTrasferta.giorniTrasfertaItalia().invalid()
              ? 'giorniTrasfertaItalia-error'
              : null
          "
        />
        @if (form.rimborsiTrasferta.giorniTrasfertaItalia().invalid()) {
          @for (
            error of form.rimborsiTrasferta.giorniTrasfertaItalia().errors();
            track error.kind
          ) {
            <span id="giorniTrasfertaItalia-error" class="error-message" role="alert">{{
              error.message
            }}</span>
          }
        }
      </div>

      <div class="form-group">
        <label for="giorniTrasfertaEstero">Giorni trasferta Estero</label>
        <input
          id="giorniTrasfertaEstero"
          type="number"
          [formField]="form.rimborsiTrasferta.giorniTrasfertaEstero"
          [attr.aria-invalid]="form.rimborsiTrasferta.giorniTrasfertaEstero().invalid()"
          [attr.aria-describedby]="
            form.rimborsiTrasferta.giorniTrasfertaEstero().invalid()
              ? 'giorniTrasfertaEstero-error'
              : null
          "
        />
        @if (form.rimborsiTrasferta.giorniTrasfertaEstero().invalid()) {
          @for (
            error of form.rimborsiTrasferta.giorniTrasfertaEstero().errors();
            track error.kind
          ) {
            <span id="giorniTrasfertaEstero-error" class="error-message" role="alert">{{
              error.message
            }}</span>
          }
        }
      </div>

      <div class="form-group">
        <label for="rimborsoVitto">Rimborso vitto documentato (€/anno)</label>
        <input
          id="rimborsoVitto"
          type="number"
          [formField]="form.rimborsiTrasferta.rimborsoVitto"
          [attr.aria-invalid]="form.rimborsiTrasferta.rimborsoVitto().invalid()"
          [attr.aria-describedby]="
            form.rimborsiTrasferta.rimborsoVitto().invalid() ? 'rimborsoVitto-error' : null
          "
        />
        @if (form.rimborsiTrasferta.rimborsoVitto().invalid()) {
          @for (error of form.rimborsiTrasferta.rimborsoVitto().errors(); track error.kind) {
            <span id="rimborsoVitto-error" class="error-message" role="alert">{{
              error.message
            }}</span>
          }
        }
      </div>

      <div class="form-group">
        <label for="rimborsoAlloggio">Rimborso alloggio documentato (€/anno)</label>
        <input
          id="rimborsoAlloggio"
          type="number"
          [formField]="form.rimborsiTrasferta.rimborsoAlloggio"
          [attr.aria-invalid]="form.rimborsiTrasferta.rimborsoAlloggio().invalid()"
          [attr.aria-describedby]="
            form.rimborsiTrasferta.rimborsoAlloggio().invalid() ? 'rimborsoAlloggio-error' : null
          "
        />
        @if (form.rimborsiTrasferta.rimborsoAlloggio().invalid()) {
          @for (error of form.rimborsiTrasferta.rimborsoAlloggio().errors(); track error.kind) {
            <span id="rimborsoAlloggio-error" class="error-message" role="alert">{{
              error.message
            }}</span>
          }
        }
      </div>

      <div class="form-group">
        <label for="rimborsoViaggio">Rimborso viaggio (€/anno)</label>
        <input
          id="rimborsoViaggio"
          type="number"
          [formField]="form.rimborsiTrasferta.rimborsoViaggio"
          [attr.aria-invalid]="form.rimborsiTrasferta.rimborsoViaggio().invalid()"
          [attr.aria-describedby]="
            form.rimborsiTrasferta.rimborsoViaggio().invalid() ? 'rimborsoViaggio-error' : null
          "
        />
        @if (form.rimborsiTrasferta.rimborsoViaggio().invalid()) {
          @for (error of form.rimborsiTrasferta.rimborsoViaggio().errors(); track error.kind) {
            <span id="rimborsoViaggio-error" class="error-message" role="alert">{{
              error.message
            }}</span>
          }
        }
      </div>

      <div class="form-group">
        <label for="rimborsoKm">Rimborso chilometrico (€/anno)</label>
        <input
          id="rimborsoKm"
          type="number"
          [formField]="form.rimborsiTrasferta.rimborsoKm"
          [attr.aria-invalid]="form.rimborsiTrasferta.rimborsoKm().invalid()"
          [attr.aria-describedby]="
            form.rimborsiTrasferta.rimborsoKm().invalid() ? 'rimborsoKm-error' : null
          "
        />
        @if (form.rimborsiTrasferta.rimborsoKm().invalid()) {
          @for (error of form.rimborsiTrasferta.rimborsoKm().errors(); track error.kind) {
            <span id="rimborsoKm-error" class="error-message" role="alert">{{
              error.message
            }}</span>
          }
        }
      </div>

      <div class="form-group checkbox">
        <input
          id="pagamentiTracciabili"
          type="checkbox"
          [formField]="form.rimborsiTrasferta.pagamentiTracciabili"
        />
        <label for="pagamentiTracciabili">Pagamenti tracciabili</label>
      </div>
    }
  </fieldset>

  <!-- Sezione Benefit Non Tassati (Welfare) -->
  <fieldset>
    <legend>Benefit Non Tassati (Welfare)</legend>

    <div class="form-group checkbox">
      <input
        id="benefitNonTassatiEnabled"
        type="checkbox"
        [formField]="form.benefitNonTassati.enabled"
      />
      <label for="benefitNonTassatiEnabled">Ho benefit non tassati</label>
    </div>

    @if (model.benefitNonTassati.enabled) {
      <div class="form-group">
        <label for="previdenzaComplementare">Previdenza complementare (€/anno)</label>
        <input
          id="previdenzaComplementare"
          type="number"
          [formField]="form.benefitNonTassati.previdenzaComplementare"
          placeholder="Max €5.164,57 esente"
          [attr.aria-invalid]="form.benefitNonTassati.previdenzaComplementare().invalid()"
          [attr.aria-describedby]="
            form.benefitNonTassati.previdenzaComplementare().invalid()
              ? 'previdenzaComplementare-error'
              : null
          "
        />
        @if (form.benefitNonTassati.previdenzaComplementare().invalid()) {
          @for (
            error of form.benefitNonTassati.previdenzaComplementare().errors();
            track error.kind
          ) {
            <span id="previdenzaComplementare-error" class="error-message" role="alert">{{
              error.message
            }}</span>
          }
        }
      </div>

      <div class="form-group">
        <label for="assistenzaSanitaria">Assistenza sanitaria (€/anno)</label>
        <input
          id="assistenzaSanitaria"
          type="number"
          [formField]="form.benefitNonTassati.assistenzaSanitaria"
          placeholder="Max €3.615,20 esente"
          [attr.aria-invalid]="form.benefitNonTassati.assistenzaSanitaria().invalid()"
          [attr.aria-describedby]="
            form.benefitNonTassati.assistenzaSanitaria().invalid()
              ? 'assistenzaSanitaria-error'
              : null
          "
        />
        @if (form.benefitNonTassati.assistenzaSanitaria().invalid()) {
          @for (error of form.benefitNonTassati.assistenzaSanitaria().errors(); track error.kind) {
            <span id="assistenzaSanitaria-error" class="error-message" role="alert">{{
              error.message
            }}</span>
          }
        }
      </div>

      <div class="form-group">
        <label for="buoniPasto">Buoni pasto (€/anno)</label>
        <input
          id="buoniPasto"
          type="number"
          [formField]="form.benefitNonTassati.buoniPasto"
          [attr.aria-invalid]="form.benefitNonTassati.buoniPasto().invalid()"
          [attr.aria-describedby]="
            form.benefitNonTassati.buoniPasto().invalid() ? 'buoniPasto-error' : null
          "
        />
        @if (form.benefitNonTassati.buoniPasto().invalid()) {
          @for (error of form.benefitNonTassati.buoniPasto().errors(); track error.kind) {
            <span id="buoniPasto-error" class="error-message" role="alert">{{
              error.message
            }}</span>
          }
        }
      </div>

      <div class="form-group checkbox">
        <input
          id="buoniPastoElettronici"
          type="checkbox"
          [formField]="form.benefitNonTassati.buoniPastoElettronici"
        />
        <label for="buoniPastoElettronici">Buoni pasto elettronici (soglia €8 invece di €4)</label>
      </div>

      <div class="form-group">
        <label for="abbonamentoTrasporto">Abbonamento trasporto pubblico (€/anno)</label>
        <input
          id="abbonamentoTrasporto"
          type="number"
          [formField]="form.benefitNonTassati.abbonamentoTrasporto"
          [attr.aria-invalid]="form.benefitNonTassati.abbonamentoTrasporto().invalid()"
          [attr.aria-describedby]="
            form.benefitNonTassati.abbonamentoTrasporto().invalid()
              ? 'abbonamentoTrasporto-error'
              : null
          "
        />
        @if (form.benefitNonTassati.abbonamentoTrasporto().invalid()) {
          @for (error of form.benefitNonTassati.abbonamentoTrasporto().errors(); track error.kind) {
            <span id="abbonamentoTrasporto-error" class="error-message" role="alert">{{
              error.message
            }}</span>
          }
        }
      </div>

      <div class="form-group">
        <label for="serviziWelfare">Servizi welfare (€/anno)</label>
        <input
          id="serviziWelfare"
          type="number"
          [formField]="form.benefitNonTassati.serviziWelfare"
          placeholder="Asili, borse studio, ecc."
          [attr.aria-invalid]="form.benefitNonTassati.serviziWelfare().invalid()"
          [attr.aria-describedby]="
            form.benefitNonTassati.serviziWelfare().invalid() ? 'serviziWelfare-error' : null
          "
        />
        @if (form.benefitNonTassati.serviziWelfare().invalid()) {
          @for (error of form.benefitNonTassati.serviziWelfare().errors(); track error.kind) {
            <span id="serviziWelfare-error" class="error-message" role="alert">{{
              error.message
            }}</span>
          }
        }
      </div>

      <div class="form-group">
        <label for="benefitNonTassatiAltri">Altri benefit non tassati (€/anno)</label>
        <input
          id="benefitNonTassatiAltri"
          type="number"
          [formField]="form.benefitNonTassati.altri"
          [attr.aria-invalid]="form.benefitNonTassati.altri().invalid()"
          [attr.aria-describedby]="
            form.benefitNonTassati.altri().invalid() ? 'benefitNonTassatiAltri-error' : null
          "
        />
        @if (form.benefitNonTassati.altri().invalid()) {
          @for (error of form.benefitNonTassati.altri().errors(); track error.kind) {
            <span id="benefitNonTassatiAltri-error" class="error-message" role="alert">{{
              error.message
            }}</span>
          }
        }
      </div>
    }
  </fieldset>
</form>
