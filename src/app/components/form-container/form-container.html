<form class="form-container">
  @let form = stipendioForm();
  @let model = formModel()();

  <!-- Sezione Dati Principali -->
  <fieldset>
    <legend>Dati Principali</legend>

    <div class="form-group">
      <label for="ral">RAL (Reddito Annuo Lordo) *</label>
      <input
        id="ral"
        type="number"
        [formField]="form.ral"
        placeholder="Es. 35000"
        aria-required="true"
        [attr.aria-invalid]="form.ral().invalid()"
        [attr.aria-describedby]="form.ral().invalid() ? 'ral-error' : null"
      />
      @if (form.ral().invalid()) {
        @for (error of form.ral().errors(); track error.kind) {
          <span id="ral-error" class="error-message" role="alert">{{ error.message }}</span>
        }
      }
    </div>

    <div class="form-group">
      <label for="mensilita">Mensilità *</label>
      <select id="mensilita" [formField]="form.mensilita" aria-required="true">
        @for (m of mensilita; track m) {
          <option [value]="m">{{ m }}</option>
        }
      </select>
    </div>

    <div class="form-group">
      <label for="tipoContratto">Tipo Contratto *</label>
      <select id="tipoContratto" [formField]="form.tipoContratto" aria-required="true">
        @for (tipo of tipiContratto; track tipo.value) {
          <option [value]="tipo.value">{{ tipo.label }}</option>
        }
      </select>
    </div>

    <div class="form-group">
      <label for="annoFiscale">Anno Fiscale *</label>
      <select id="annoFiscale" [formField]="form.annoFiscale" aria-required="true">
        @for (anno of anniFiscali; track anno) {
          <option [value]="anno">{{ anno }}</option>
        }
      </select>
    </div>

    <div class="form-group">
      <label for="regione">Regione *</label>
      <select id="regione" [formField]="form.regione" aria-required="true">
        @for (regione of regioniDisponibili; track regione.value) {
          <option [value]="regione.value">{{ regione.label }}</option>
        }
      </select>
    </div>

    <div class="form-group">
      <label for="comune">Comune *</label>
      <select id="comune" [formField]="form.comune" aria-required="true">
        @for (comune of comuniDisponibili; track comune.value) {
          <option [value]="comune.value">{{ comune.label }}</option>
        }
      </select>
    </div>
  </fieldset>

  <!-- Sezione Opzioni Contrattuali -->
  <fieldset>
    <legend>Opzioni Contrattuali</legend>

    <div class="form-group">
      <label for="giorniLavorati">Giorni Lavorati (opzionale)</label>
      <input
        id="giorniLavorati"
        type="number"
        [formField]="form.giorniLavorati"
        placeholder="Default: 365"
      />
    </div>

    <div class="form-group checkbox">
      <input id="aziendaConCigs" type="checkbox" [formField]="form.aziendaConCigs" />
      <label for="aziendaConCigs">Azienda con più di 15 dipendenti (CIGS)</label>
    </div>

    <div class="form-group checkbox">
      <input id="iscrittoPost1996" type="checkbox" [formField]="form.iscrittoPost1996" />
      <label for="iscrittoPost1996">Iscritto alla previdenza dal 1996 in poi</label>
    </div>

    <div class="form-group checkbox">
      <input
        id="neoassuntoFuoriSede2025"
        type="checkbox"
        [formField]="form.neoassuntoFuoriSede2025"
      />
      <label for="neoassuntoFuoriSede2025">Neoassunto 2025 fuori sede (>100km)</label>
    </div>
  </fieldset>

  <!-- Sezione Altri Redditi e Detrazioni -->
  <fieldset>
    <legend>Altri Redditi e Detrazioni</legend>

    <div class="form-group">
      <label for="altriRedditi">Altri Redditi (€/anno)</label>
      <input
        id="altriRedditi"
        type="number"
        [formField]="form.altriRedditi"
        placeholder="Es. redditi fondiari"
      />
    </div>

    <div class="form-group">
      <label for="altreDetrazioni">Altre Detrazioni (€/anno)</label>
      <input
        id="altreDetrazioni"
        type="number"
        [formField]="form.altreDetrazioni"
        placeholder="Es. interessi mutuo"
      />
    </div>
  </fieldset>

  <!-- Sezione Coniuge a Carico -->
  <fieldset>
    <legend>Coniuge a Carico</legend>

    <div class="form-group checkbox">
      <input id="coniugeEnabled" type="checkbox" [formField]="form.coniuge.enabled" />
      <label for="coniugeEnabled">Ho un coniuge a carico</label>
    </div>

    @if (model.coniuge.enabled) {
      <div class="form-group">
        <label for="coniugeReddito">Reddito annuo coniuge (€)</label>
        <input
          id="coniugeReddito"
          type="number"
          [formField]="form.coniuge.redditoAnnuo"
          placeholder="Max €2.840,51 per detrazione"
        />
      </div>

      <div class="form-group">
        <label for="coniugePercentuale">Percentuale a carico (%)</label>
        <input id="coniugePercentuale" type="number" [formField]="form.coniuge.percentualeCarico" />
      </div>
    }
  </fieldset>

  <!-- Sezione Figli a Carico -->
  <fieldset>
    <legend>Figli a Carico</legend>

    <div class="form-group checkbox">
      <input id="haFigliACarico" type="checkbox" [formField]="form.haFigliACarico" />
      <label for="haFigliACarico">Ho figli a carico (per soglia fringe benefit)</label>
    </div>

    @for (figlio of model.figli; track $index) {
      <div class="nested-item">
        <h4>Figlio {{ $index + 1 }}</h4>

        <div class="form-group">
          <label [for]="'figlioEta' + $index">Età</label>
          <input [id]="'figlioEta' + $index" type="number" [formField]="form.figli[$index].eta" />
        </div>

        <div class="form-group checkbox">
          <input
            [id]="'figlioDisabile' + $index"
            type="checkbox"
            [formField]="form.figli[$index].disabile"
          />
          <label [for]="'figlioDisabile' + $index">Disabile</label>
        </div>

        <div class="form-group">
          <label [for]="'figlioPercentuale' + $index">Percentuale a carico (%)</label>
          <input
            [id]="'figlioPercentuale' + $index"
            type="number"
            [formField]="form.figli[$index].percentualeCarico"
          />
        </div>

        <button type="button" (click)="removeFiglio($index)">Rimuovi figlio</button>
      </div>
    }

    <button type="button" (click)="addFiglio()">Aggiungi figlio</button>
  </fieldset>

  <!-- Sezione Ascendenti a Carico -->
  <fieldset>
    <legend>Ascendenti a Carico (genitori/nonni)</legend>

    @for (ascendente of model.ascendenti; track $index) {
      <div class="nested-item">
        <h4>Ascendente {{ $index + 1 }}</h4>

        <div class="form-group">
          <label [for]="'ascendenteReddito' + $index">Reddito annuo (€)</label>
          <input
            [id]="'ascendenteReddito' + $index"
            type="number"
            [formField]="form.ascendenti[$index].redditoAnnuo"
          />
        </div>

        <div class="form-group checkbox">
          <input
            [id]="'ascendenteConvivente' + $index"
            type="checkbox"
            [formField]="form.ascendenti[$index].convivente"
          />
          <label [for]="'ascendenteConvivente' + $index">Convivente</label>
        </div>

        <button type="button" (click)="removeAscendente($index)">Rimuovi ascendente</button>
      </div>
    }

    <button type="button" (click)="addAscendente()">Aggiungi ascendente</button>
  </fieldset>

  <!-- Sezione Fringe Benefit -->
  <fieldset>
    <legend>Fringe Benefit</legend>

    <div class="form-group checkbox">
      <input id="fringeBenefitEnabled" type="checkbox" [formField]="form.fringeBenefit.enabled" />
      <label for="fringeBenefitEnabled">Ho fringe benefit</label>
    </div>

    @if (model.fringeBenefit.enabled) {
      <div class="form-group">
        <label for="buoniAcquisto">Buoni acquisto/spesa (€/anno)</label>
        <input id="buoniAcquisto" type="number" [formField]="form.fringeBenefit.buoniAcquisto" />
      </div>

      <div class="form-group">
        <label for="buoniCarburante">Buoni carburante (€/anno)</label>
        <input
          id="buoniCarburante"
          type="number"
          [formField]="form.fringeBenefit.buoniCarburante"
        />
      </div>

      <div class="form-group">
        <label for="rimborsoUtenze">Rimborso utenze domestiche (€/anno)</label>
        <input id="rimborsoUtenze" type="number" [formField]="form.fringeBenefit.rimborsoUtenze" />
      </div>

      <div class="form-group">
        <label for="rimborsoAffitto">Rimborso affitto prima casa (€/anno)</label>
        <input
          id="rimborsoAffitto"
          type="number"
          [formField]="form.fringeBenefit.rimborsoAffitto"
        />
      </div>

      <div class="form-group">
        <label for="rimborsoInteressiMutuo">Rimborso interessi mutuo (€/anno)</label>
        <input
          id="rimborsoInteressiMutuo"
          type="number"
          [formField]="form.fringeBenefit.rimborsoInteressiMutuo"
        />
      </div>

      <div class="form-group">
        <label for="fringeBenefitAltri">Altri fringe benefit (€/anno)</label>
        <input id="fringeBenefitAltri" type="number" [formField]="form.fringeBenefit.altri" />
      </div>

      <!-- Auto Aziendale -->
      <div class="form-group checkbox">
        <input
          id="autoAziendaleEnabled"
          type="checkbox"
          [formField]="form.fringeBenefit.autoAziendaleEnabled"
        />
        <label for="autoAziendaleEnabled">Ho auto aziendale</label>
      </div>

      @if (model.fringeBenefit.autoAziendaleEnabled) {
        <div class="nested-item">
          <h4>Auto Aziendale</h4>

          <div class="form-group">
            <label for="costoKmAci">Costo km ACI (€/km)</label>
            <input
              id="costoKmAci"
              type="number"
              [formField]="form.fringeBenefit.autoAziendale.costoKmAci"
            />
          </div>

          <div class="form-group">
            <label for="tipoAlimentazione">Tipo alimentazione</label>
            <select
              id="tipoAlimentazione"
              [formField]="form.fringeBenefit.autoAziendale.tipoAlimentazione"
            >
              @for (tipo of tipiAlimentazione; track tipo.value) {
                <option [value]="tipo.value">{{ tipo.label }}</option>
              }
            </select>
          </div>

          <div class="form-group">
            <label for="mesiUtilizzo">Mesi di utilizzo</label>
            <input
              id="mesiUtilizzo"
              type="number"
              [formField]="form.fringeBenefit.autoAziendale.mesiUtilizzo"
            />
          </div>

          <div class="form-group">
            <label for="trattenutaDipendente">Trattenuta dipendente (€/anno)</label>
            <input
              id="trattenutaDipendente"
              type="number"
              [formField]="form.fringeBenefit.autoAziendale.trattenutaDipendente"
            />
          </div>

          <div class="form-group checkbox">
            <input
              id="assegnatoPre2025"
              type="checkbox"
              [formField]="form.fringeBenefit.autoAziendale.assegnatoPre2025"
            />
            <label for="assegnatoPre2025">Assegnato prima del 2025 (regime CO2)</label>
          </div>

          @if (model.fringeBenefit.autoAziendale.assegnatoPre2025) {
            <div class="form-group">
              <label for="emissioniCO2">Emissioni CO2 (g/km)</label>
              <input
                id="emissioniCO2"
                type="number"
                [formField]="form.fringeBenefit.autoAziendale.emissioniCO2"
              />
            </div>
          }
        </div>
      }
    }
  </fieldset>

  <!-- Sezione Rimborsi Trasferta -->
  <fieldset>
    <legend>Rimborsi Trasferta</legend>

    <div class="form-group checkbox">
      <input
        id="rimborsiTrasfertaEnabled"
        type="checkbox"
        [formField]="form.rimborsiTrasferta.enabled"
      />
      <label for="rimborsiTrasfertaEnabled">Ho rimborsi trasferta</label>
    </div>

    @if (model.rimborsiTrasferta.enabled) {
      <div class="form-group">
        <label for="modalitaRimborso">Modalità rimborso</label>
        <select id="modalitaRimborso" [formField]="form.rimborsiTrasferta.modalitaRimborso">
          @for (modalita of modalitaRimborso; track modalita.value) {
            <option [value]="modalita.value">{{ modalita.label }}</option>
          }
        </select>
      </div>

      <div class="form-group">
        <label for="giorniTrasfertaItalia">Giorni trasferta Italia</label>
        <input
          id="giorniTrasfertaItalia"
          type="number"
          [formField]="form.rimborsiTrasferta.giorniTrasfertaItalia"
        />
      </div>

      <div class="form-group">
        <label for="giorniTrasfertaEstero">Giorni trasferta Estero</label>
        <input
          id="giorniTrasfertaEstero"
          type="number"
          [formField]="form.rimborsiTrasferta.giorniTrasfertaEstero"
        />
      </div>

      <div class="form-group">
        <label for="rimborsoVitto">Rimborso vitto documentato (€/anno)</label>
        <input
          id="rimborsoVitto"
          type="number"
          [formField]="form.rimborsiTrasferta.rimborsoVitto"
        />
      </div>

      <div class="form-group">
        <label for="rimborsoAlloggio">Rimborso alloggio documentato (€/anno)</label>
        <input
          id="rimborsoAlloggio"
          type="number"
          [formField]="form.rimborsiTrasferta.rimborsoAlloggio"
        />
      </div>

      <div class="form-group">
        <label for="rimborsoViaggio">Rimborso viaggio (€/anno)</label>
        <input
          id="rimborsoViaggio"
          type="number"
          [formField]="form.rimborsiTrasferta.rimborsoViaggio"
        />
      </div>

      <div class="form-group">
        <label for="rimborsoKm">Rimborso chilometrico (€/anno)</label>
        <input id="rimborsoKm" type="number" [formField]="form.rimborsiTrasferta.rimborsoKm" />
      </div>

      <div class="form-group checkbox">
        <input
          id="pagamentiTracciabili"
          type="checkbox"
          [formField]="form.rimborsiTrasferta.pagamentiTracciabili"
        />
        <label for="pagamentiTracciabili">Pagamenti tracciabili</label>
      </div>
    }
  </fieldset>

  <!-- Sezione Benefit Non Tassati (Welfare) -->
  <fieldset>
    <legend>Benefit Non Tassati (Welfare)</legend>

    <div class="form-group checkbox">
      <input
        id="benefitNonTassatiEnabled"
        type="checkbox"
        [formField]="form.benefitNonTassati.enabled"
      />
      <label for="benefitNonTassatiEnabled">Ho benefit non tassati</label>
    </div>

    @if (model.benefitNonTassati.enabled) {
      <div class="form-group">
        <label for="previdenzaComplementare">Previdenza complementare (€/anno)</label>
        <input
          id="previdenzaComplementare"
          type="number"
          [formField]="form.benefitNonTassati.previdenzaComplementare"
          placeholder="Max €5.164,57 esente"
        />
      </div>

      <div class="form-group">
        <label for="assistenzaSanitaria">Assistenza sanitaria (€/anno)</label>
        <input
          id="assistenzaSanitaria"
          type="number"
          [formField]="form.benefitNonTassati.assistenzaSanitaria"
          placeholder="Max €3.615,20 esente"
        />
      </div>

      <div class="form-group">
        <label for="buoniPasto">Buoni pasto (€/anno)</label>
        <input id="buoniPasto" type="number" [formField]="form.benefitNonTassati.buoniPasto" />
      </div>

      <div class="form-group checkbox">
        <input
          id="buoniPastoElettronici"
          type="checkbox"
          [formField]="form.benefitNonTassati.buoniPastoElettronici"
        />
        <label for="buoniPastoElettronici">Buoni pasto elettronici (soglia €8 invece di €4)</label>
      </div>

      <div class="form-group">
        <label for="abbonamentoTrasporto">Abbonamento trasporto pubblico (€/anno)</label>
        <input
          id="abbonamentoTrasporto"
          type="number"
          [formField]="form.benefitNonTassati.abbonamentoTrasporto"
        />
      </div>

      <div class="form-group">
        <label for="serviziWelfare">Servizi welfare (€/anno)</label>
        <input
          id="serviziWelfare"
          type="number"
          [formField]="form.benefitNonTassati.serviziWelfare"
          placeholder="Asili, borse studio, ecc."
        />
      </div>

      <div class="form-group">
        <label for="benefitNonTassatiAltri">Altri benefit non tassati (€/anno)</label>
        <input
          id="benefitNonTassatiAltri"
          type="number"
          [formField]="form.benefitNonTassati.altri"
        />
      </div>
    }
  </fieldset>
</form>
