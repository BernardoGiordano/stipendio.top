<header
  class="border-b border-stone-200 bg-white/80 backdrop-blur-sm sticky top-0 z-50 dark:border-stone-700 dark:bg-stone-900/80"
>
  <div class="max-w-7xl mx-auto px-4 lg:px-8 py-3 flex items-center justify-between">
    <!-- Left side: Logo -->
    <div class="flex items-center gap-2">
      <h1 class="text-xl font-semibold tracking-tight text-stone-900 dark:text-stone-100 mr-4">
        Stipendio.üîù
      </h1>
      <a
        href="https://github.com/BernardoGiordano/stipendio.top"
        target="_blank"
        rel="noopener noreferrer"
        class="hidden lg:flex items-center gap-2 p-2 rounded-lg text-stone-500 hover:text-stone-700 hover:bg-stone-100 dark:text-stone-400 dark:hover:text-stone-200 dark:hover:bg-stone-800 transition-all duration-300 overflow-hidden group"
        aria-label="GitHub"
      >
        <svg
          class="size-5 flex-shrink-0"
          fill="currentColor"
          viewBox="0 0 24 24"
          aria-hidden="true"
        >
          <path
            fill-rule="evenodd"
            d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z"
            clip-rule="evenodd"
          />
        </svg>
        <span
          class="text-sm font-medium whitespace-nowrap max-w-0 group-hover:max-w-xs overflow-hidden opacity-0 group-hover:opacity-100 hover-text-delay"
          >GitHub</span
        >
      </a>
      <a
        href="https://www.paypal.com/paypalme/BernardoGiordano"
        target="_blank"
        rel="noopener noreferrer"
        class="hidden lg:flex items-center gap-2 p-2 rounded-lg text-stone-500 hover:text-stone-700 hover:bg-stone-100 dark:text-stone-400 dark:hover:text-stone-200 dark:hover:bg-stone-800 transition-all duration-300 overflow-hidden group"
        aria-label="PayPal"
      >
        <svg
          class="size-5 flex-shrink-0"
          fill="currentColor"
          viewBox="0 0 24 24"
          aria-hidden="true"
        >
          <path
            d="M7.076 21.337H2.47a.641.641 0 0 1-.633-.74L4.944 3.72a.77.77 0 0 1 .757-.649h6.403c2.12 0 3.804.482 4.873 1.392.996.849 1.39 2.063 1.174 3.617l-.005.023c-.42 2.72-2.043 4.461-4.732 5.085-.608.14-1.275.212-1.988.212H9.042l-.934 6.072a.77.77 0 0 1-.757.649H7.35l.001-.001h-.275z"
          />
          <path
            d="M19.873 8.38c-.064.418-.163.86-.3 1.327-.89 3.043-3.266 4.607-7.064 4.607h-.477l-1.017 6.598a.642.642 0 0 1-.632.551H7.42l.234-1.519.094-.609.934-6.072h2.384c.713 0 1.38-.072 1.988-.212 2.689-.624 4.312-2.365 4.732-5.085l.005-.023c.09-.594.085-1.109-.026-1.563h.025c.627.292 1.06.733 1.324 1.35.235.55.336 1.22.286 2.011l-.001.013a8.073 8.073 0 0 1-.527 1.626z"
            opacity="0.7"
          />
        </svg>
        <span
          class="text-sm font-medium whitespace-nowrap max-w-0 group-hover:max-w-xs overflow-hidden opacity-0 group-hover:opacity-100 hover-text-delay"
          >Supporta</span
        >
      </a>
      <button
        type="button"
        class="hidden lg:flex items-center gap-2 p-2 cursor-pointer rounded-lg text-stone-500 hover:text-stone-700 hover:bg-stone-100 dark:text-stone-400 dark:hover:text-stone-200 dark:hover:bg-stone-800 transition-all duration-300 overflow-hidden group"
        aria-label="Cambia tema"
        (click)="themeMode.toggle()"
      >
        @if (themeMode.isDark()) {
          <svg
            class="size-5 flex-shrink-0"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            aria-hidden="true"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z"
            />
          </svg>
          <span
            class="text-sm font-medium whitespace-nowrap max-w-0 group-hover:max-w-xs overflow-hidden opacity-0 group-hover:opacity-100 hover-text-delay"
            >Tema chiaro</span
          >
        } @else {
          <svg
            class="size-5 flex-shrink-0"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            aria-hidden="true"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M21.752 15.002A9.72 9.72 0 0 1 18 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 0 0 3 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 0 0 9.002-5.998Z"
            />
          </svg>
          <span
            class="text-sm font-medium whitespace-nowrap max-w-0 group-hover:max-w-xs overflow-hidden opacity-0 group-hover:opacity-100 hover-text-delay"
            >Tema scuro</span
          >
        }
      </button>
    </div>

    <!-- Right side: Amounts (mobile only) + Menu -->
    <div class="flex items-center gap-2">
      <!-- Netto/Percepito Toggle (hidden on small screens) -->
      <div
        class="hidden lg:flex rounded-lg overflow-hidden text-xs"
        role="group"
        aria-label="Modalit√† visualizzazione importi"
      >
        <button
          type="button"
          [class]="
            displayMode.isNetto()
              ? 'px-2.5 py-1.5 font-medium cursor-pointer bg-stone-900 text-white dark:bg-stone-100 dark:text-stone-900'
              : 'px-2.5 py-1.5 font-medium cursor-pointer bg-stone-100 text-stone-600 hover:bg-stone-200 dark:bg-stone-800 dark:text-stone-400 dark:hover:bg-stone-700'
          "
          [attr.aria-pressed]="displayMode.isNetto()"
          (click)="displayMode.setMode('netto')"
        >
          Netto
        </button>
        <button
          type="button"
          [class]="
            displayMode.isPercepito()
              ? 'px-2.5 py-1.5 font-medium cursor-pointer bg-stone-900 text-white dark:bg-stone-100 dark:text-stone-900'
              : 'px-2.5 py-1.5 font-medium cursor-pointer bg-stone-100 text-stone-600 hover:bg-stone-200 dark:bg-stone-800 dark:text-stone-400 dark:hover:bg-stone-700'
          "
          [attr.aria-pressed]="displayMode.isPercepito()"
          (click)="displayMode.setMode('percepito')"
        >
          Percepito
        </button>
      </div>

      @if (calculationResult(); as r) {
        <div
          class="flex items-center gap-4 text-right lg:hidden mr-2 pr-2 border-r border-stone-200 dark:border-stone-700"
        >
          <div class="flex flex-col">
            <span class="text-[10px] text-stone-400 uppercase tracking-wide">Mensile</span>
            <span class="text-sm font-semibold text-stone-900 dark:text-stone-100">{{
              formatCurrency(displayMode.isPercepito() ? r.nettoMensilePercepito : r.nettoMensile)
            }}</span>
          </div>
          <div class="flex flex-col">
            <span class="text-[10px] text-stone-400 uppercase tracking-wide">Annuo</span>
            <span class="text-sm font-semibold text-stone-900 dark:text-stone-100">{{
              formatCurrency(displayMode.isPercepito() ? r.totalePercepito : r.nettoAnnuo)
            }}</span>
          </div>
        </div>
      }

      <!-- Menu trigger button (visible only on small screens) -->
      <button
        type="button"
        class="lg:hidden p-2 cursor-pointer rounded-lg text-stone-500 hover:text-stone-700 hover:bg-stone-100 dark:text-stone-400 dark:hover:text-stone-200 dark:hover:bg-stone-800 transition-colors"
        aria-label="Menu"
        [cdkMenuTriggerFor]="menu"
      >
        <svg
          class="size-5"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="1.5"
          stroke="currentColor"
          aria-hidden="true"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"
          />
        </svg>
      </button>

      <!-- CDK Menu -->
      <ng-template #menu>
        <div
          cdkMenu
          class="min-w-[200px] rounded-lg bg-white dark:bg-stone-800 shadow-lg ring-1 ring-stone-200 dark:ring-stone-700 py-1 focus:outline-none"
        >
          <!-- Display mode group -->
          <div cdkMenuGroup>
            <button
              cdkMenuItemRadio
              [cdkMenuItemChecked]="displayMode.isNetto()"
              (cdkMenuItemTriggered)="displayMode.setMode('netto')"
              class="flex w-full items-center gap-3 px-4 py-2 text-sm text-stone-700 dark:text-stone-200 hover:bg-stone-100 dark:hover:bg-stone-700 focus:bg-stone-100 dark:focus:bg-stone-700 focus:outline-none cursor-pointer"
            >
              <span class="size-4 flex items-center justify-center">
                @if (displayMode.isNetto()) {
                  <svg class="size-4" fill="currentColor" viewBox="0 0 20 20">
                    <path
                      fill-rule="evenodd"
                      d="M16.704 4.153a.75.75 0 01.143 1.052l-8 10.5a.75.75 0 01-1.127.075l-4.5-4.5a.75.75 0 011.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 011.05-.143z"
                      clip-rule="evenodd"
                    />
                  </svg>
                }
              </span>
              Mostra netto
            </button>
            <button
              cdkMenuItemRadio
              [cdkMenuItemChecked]="displayMode.isPercepito()"
              (cdkMenuItemTriggered)="displayMode.setMode('percepito')"
              class="flex w-full items-center gap-3 px-4 py-2 text-sm text-stone-700 dark:text-stone-200 hover:bg-stone-100 dark:hover:bg-stone-700 focus:bg-stone-100 dark:focus:bg-stone-700 focus:outline-none cursor-pointer"
            >
              <span class="size-4 flex items-center justify-center">
                @if (displayMode.isPercepito()) {
                  <svg class="size-4" fill="currentColor" viewBox="0 0 20 20">
                    <path
                      fill-rule="evenodd"
                      d="M16.704 4.153a.75.75 0 01.143 1.052l-8 10.5a.75.75 0 01-1.127.075l-4.5-4.5a.75.75 0 011.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 011.05-.143z"
                      clip-rule="evenodd"
                    />
                  </svg>
                }
              </span>
              Mostra percepito
            </button>
          </div>

          <!-- Divider -->
          <div class="my-1 border-t border-stone-200 dark:border-stone-700"></div>

          <!-- Theme mode group -->
          <div cdkMenuGroup>
            <button
              cdkMenuItemRadio
              [cdkMenuItemChecked]="themeMode.isLight()"
              (cdkMenuItemTriggered)="themeMode.setTheme('light')"
              class="flex w-full items-center gap-3 px-4 py-2 text-sm text-stone-700 dark:text-stone-200 hover:bg-stone-100 dark:hover:bg-stone-700 focus:bg-stone-100 dark:focus:bg-stone-700 focus:outline-none cursor-pointer"
            >
              <span class="size-4 flex items-center justify-center">
                @if (themeMode.isLight()) {
                  <svg class="size-4" fill="currentColor" viewBox="0 0 20 20">
                    <path
                      fill-rule="evenodd"
                      d="M16.704 4.153a.75.75 0 01.143 1.052l-8 10.5a.75.75 0 01-1.127.075l-4.5-4.5a.75.75 0 011.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 011.05-.143z"
                      clip-rule="evenodd"
                    />
                  </svg>
                }
              </span>
              Tema chiaro
            </button>
            <button
              cdkMenuItemRadio
              [cdkMenuItemChecked]="themeMode.isDark()"
              (cdkMenuItemTriggered)="themeMode.setTheme('dark')"
              class="flex w-full items-center gap-3 px-4 py-2 text-sm text-stone-700 dark:text-stone-200 hover:bg-stone-100 dark:hover:bg-stone-700 focus:bg-stone-100 dark:focus:bg-stone-700 focus:outline-none cursor-pointer"
            >
              <span class="size-4 flex items-center justify-center">
                @if (themeMode.isDark()) {
                  <svg class="size-4" fill="currentColor" viewBox="0 0 20 20">
                    <path
                      fill-rule="evenodd"
                      d="M16.704 4.153a.75.75 0 01.143 1.052l-8 10.5a.75.75 0 01-1.127.075l-4.5-4.5a.75.75 0 011.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 011.05-.143z"
                      clip-rule="evenodd"
                    />
                  </svg>
                }
              </span>
              Tema scuro
            </button>
          </div>

          <!-- Divider -->
          <div class="my-1 border-t border-stone-200 dark:border-stone-700"></div>

          <!-- Links -->
          <a
            cdkMenuItem
            href="https://github.com/BernardoGiordano/stipendio.top"
            target="_blank"
            rel="noopener noreferrer"
            class="flex w-full items-center gap-3 px-4 py-2 text-sm text-stone-700 dark:text-stone-200 hover:bg-stone-100 dark:hover:bg-stone-700 focus:bg-stone-100 dark:focus:bg-stone-700 focus:outline-none cursor-pointer"
          >
            <svg class="size-4" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path
                fill-rule="evenodd"
                d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z"
                clip-rule="evenodd"
              />
            </svg>
            Sorgente su GitHub
          </a>
          <a
            cdkMenuItem
            href="https://www.paypal.com/paypalme/BernardoGiordano"
            target="_blank"
            rel="noopener noreferrer"
            class="flex w-full items-center gap-3 px-4 py-2 text-sm text-stone-700 dark:text-stone-200 hover:bg-stone-100 dark:hover:bg-stone-700 focus:bg-stone-100 dark:focus:bg-stone-700 focus:outline-none cursor-pointer"
          >
            <svg class="size-4" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path
                d="M7.076 21.337H2.47a.641.641 0 0 1-.633-.74L4.944 3.72a.77.77 0 0 1 .757-.649h6.403c2.12 0 3.804.482 4.873 1.392.996.849 1.39 2.063 1.174 3.617l-.005.023c-.42 2.72-2.043 4.461-4.732 5.085-.608.14-1.275.212-1.988.212H9.042l-.934 6.072a.77.77 0 0 1-.757.649H7.35l.001-.001h-.275z"
              />
              <path
                d="M19.873 8.38c-.064.418-.163.86-.3 1.327-.89 3.043-3.266 4.607-7.064 4.607h-.477l-1.017 6.598a.642.642 0 0 1-.632.551H7.42l.234-1.519.094-.609.934-6.072h2.384c.713 0 1.38-.072 1.988-.212 2.689-.624 4.312-2.365 4.732-5.085l.005-.023c.09-.594.085-1.109-.026-1.563h.025c.627.292 1.06.733 1.324 1.35.235.55.336 1.22.286 2.011l-.001.013a8.073 8.073 0 0 1-.527 1.626z"
                opacity="0.7"
              />
            </svg>
            Supporta con PayPal
          </a>

          <!-- Divider -->
          <div class="my-1 border-t border-stone-200 dark:border-stone-700"></div>

          <!-- Build info -->
          <div
            class="flex w-full items-center gap-3 px-4 py-2 text-xs text-stone-400 dark:text-stone-500 cursor-default select-none"
          >
            <svg
              class="size-4"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="1.5"
              stroke="currentColor"
              aria-hidden="true"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z"
              />
            </svg>
            v: {{ buildInfo.buildDate }} ({{ buildInfo.gitCommit }})
          </div>
        </div>
      </ng-template>
    </div>
  </div>
</header>

<main
  class="flex flex-col lg:flex-row gap-6 lg:gap-0 p-4 lg:p-8 max-w-7xl mx-auto"
  [style.--split-ratio]="splitRatio()"
>
  <div class="w-full lg:w-auto lg:flex-[var(--split-ratio)]">
    <app-form-container [stipendioForm]="stipendioForm" [formModel]="formModel" />
  </div>
  <app-resizer (resize)="onResize($event)" />
  <div class="w-full lg:w-auto lg:flex-[calc(1-var(--split-ratio))]">
    <app-results [result]="calculationResult()" [baseInput]="calculationInput()" />
  </div>
</main>

<div class="bg-stone-100 dark:bg-stone-800">
  <div class="max-w-7xl mx-auto px-4 lg:px-8 py-2.5 flex items-center justify-between gap-4">
    <p class="text-sm text-stone-600 dark:text-stone-300">
      @if (loadedFromUrl()) {
        <span class="font-medium text-emerald-600 dark:text-emerald-400"
          >Configurazione caricata da link condiviso.</span
        >
      } @else {
        Condividi questa configurazione con un link.
      }
    </p>
    <button
      type="button"
      class="inline-flex items-center gap-2 px-3 py-1.5 text-sm font-medium rounded-lg cursor-pointer transition-colors bg-stone-900 text-white hover:bg-stone-800 dark:bg-stone-100 dark:text-stone-900 dark:hover:bg-stone-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-stone-500 focus-visible:ring-offset-2"
      (click)="copyShareableLink()"
    >
      @if (formStateShare.linkCopied()) {
        <svg
          class="size-4"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="2"
          stroke="currentColor"
          aria-hidden="true"
        >
          <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5" />
        </svg>
        Copiato!
      } @else {
        <svg
          class="size-4"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="1.5"
          stroke="currentColor"
          aria-hidden="true"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M13.19 8.688a4.5 4.5 0 0 1 1.242 7.244l-4.5 4.5a4.5 4.5 0 0 1-6.364-6.364l1.757-1.757m13.35-.622 1.757-1.757a4.5 4.5 0 0 0-6.364-6.364l-4.5 4.5a4.5 4.5 0 0 0 1.242 7.244"
          />
        </svg>
        Copia link
      }
    </button>
  </div>
</div>

<footer class="bg-white dark:bg-gray-900/30">
  <div
    class="max-w-7xl mx-auto px-4 lg:px-8 py-4 flex flex-col sm:flex-row items-center justify-between gap-2 text-sm text-green-800 dark:text-green-200"
  >
    <p class="text-gray-400 text-center md:text-left">
      Il calcolatore dello stipendio netto per lavoratori dipendenti privati in Italia.
    </p>
    <p>
      Realizzato con <span class="text-red-500" aria-label="amore">&#10084;</span> da
      <a
        href="https://github.com/BernardoGiordano"
        target="_blank"
        rel="noopener noreferrer"
        class="font-bold hover:text-blue-600 dark:hover:text-white"
        >Bernardo Giordano</a
      >
    </p>
  </div>
</footer>
